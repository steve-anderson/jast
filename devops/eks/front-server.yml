apiVersion: v1
kind: Service
metadata:
  name: front-server
  labels:
    app: front-server
spec:
  ports:
  - port: 8080
    name: http
  selector:
    app: front-server
# if using a ingress, the service can't have an external ip.
#  externalIPs: ["10.41.77.144"]
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: front-server
  labels:
    app: front-server
# didn't work for automatic istio sidecar injection
#  annotations:
#    sidecar.istio.io/inject: "true"
spec:
  replicas: 2
  selector:
    matchLabels:
      app: front-server
  template:
    metadata:
      labels:
        app: front-server
    spec:
      containers:
      - name: front-server
        image: localhost:30000/research/jast/front-server:1.0
        imagePullPolicy: Always
        command: ["/opt/jboss/wildfly/bin/standalone.sh","-Djboss.node.name=front-server","--debug","5000","-b","0.0.0.0","-bmanagement","0.0.0.0"]
        ports:
        - containerPort: 8080
          name: http
